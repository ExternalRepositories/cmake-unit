language: cpp
sudo: false
cache:
  directories:
  - container
env:
- CMAKE_GENERATOR="Unix Makefiles" CMAKE_VERSION="latest" DEPLOY="1"
- CMAKE_GENERATOR="Ninja" CMAKE_VERSION="latest"
- CMAKE_GENERATOR="Unix Makefiles" CMAKE_VERSION="3.0"
- CMAKE_GENERATOR="Ninja" CMAKE_VERSION="3.0"
- CMAKE_GENERATOR="Unix Makefiles" CMAKE_VERSION="2.8"
- CMAKE_GENERATOR="Ninja" CMAKE_VERSION="2.8"
- CMAKE_GENERATOR="Unix Makefiles" CMAKE_VERSION="latest" COVERAGE="--use-cmake-coverage"
install:
- eval $(curl -LSs --retry 100 --connect-timeout 3 public-travis-scripts.polysquare.org/bootstrap.py | python /dev/stdin -d container -s setup/bii/setup.py -e bash -p /dev/stdout --cmake-version ${CMAKE_VERSION})
script:
- polysquare_run check/bii/check.py ${COVERAGE} --cmake-namespace cmake_unit --generator "${CMAKE_GENERATOR}" --lint-exclude "*FileForCoverage.cmake" --block "smspillaz/cmake-unit"
before_cache:
- polysquare_cleanup
after_success:
- polysquare_run coverage/cmake/coverage.py
before_deploy:
- polysquare_run deploy/bii/deploy.py
deploy:
  provider: biicode
  user:
    secure: MVBlNXjlQ3CYQltHKevP7/WQrBgtYJRbe0OoVpvKAfB+sYD54nBhn85a0Jo8zY+jtyLDLa8a7cMdWgnVgL+8NNFTm0QBqGprC/BUGHgBiWa6k3fK2+SuAt3BY18pTLOTL/pLhzwGFvZ3QQ903wAlp8qR8LlTvx2iKhf8H3ANBYI=
  password:
    secure: ECvfXt6dC/qX4ULgJbAICgf+u08vUFPBH0TVMNLAmfe9J38ZF8MyrV51JfqP3tELt6tJ8Yk2hSDd6D5LxfMDTSsrw9oaD+69HKO0fLeR/yD96r+TKEkqHWxgi/oez8fTUHZrLT2n7zrqsg4JwuxYFuQ7ARr0IirgaPF5+bw7t38=
  on:
    repo: polysquare/cmake-unit
    branch: master
    condition: ${DEPLOY} = 1